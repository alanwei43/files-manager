(function(t){function e(e){for(var a,o,s=e[0],l=e[1],u=e[2],f=0,p=[];f<s.length;f++)o=s[f],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&p.push(i[o][0]),i[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);c&&c(e);while(p.length)p.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},i={app:0},r=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var c=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("a133"),n("ed0d"),n("f09c"),n("e117");var a=n("0261"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("router-view")},r=[];n("b4fb"),n("9302"),n("2eeb"),n("fe8a"),n("e18c");function o(t,e,n,a){var i={method:t,headers:{"content-type":"application/json"}};return n&&(e+="?"+Object.keys(n).map((function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n[t]))})).join("&")),a&&(i.body=JSON.stringify(a)),fetch(e,i).then((function(t){return t.json()}))}function s(t,e){return o("GET",t,e)}function l(t,e,n){return o("POST",t,n,e)}function u(t,e){return l("/api/dir",{name:e,path:t})}function c(t,e){return o("DELETE","/api/dir",null,{name:e,path:t})}function f(t,e){return o("DELETE","/api/files",null,{name:e,path:t})}function p(t){return s("/api/files",{path:t})}n("20a5"),n("e35a"),n("1c2e"),n("5e9f"),n("0d7a");function d(t){return new Promise((function(e,n){var a=new FileReader;a.onload=function(t){var n=t.target.result.split("base64,")[1];e(n)},a.onerror=function(){n()},a.readAsDataURL(t)}))}function h(){return Date.now().toString(16)+Math.random().toString(16).substr(2)}function m(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];return n.join(t).replace(/(\/{2,})/,"/").replace(/(\\{2,})/,"\\")}function v(t){var e=t/1024;if(e<1024)return{size:e.toFixed(2),unit:"KB"};var n=e/1024;if(n<1024)return{size:n.toFixed(2),unit:"MB"};var a=n/1024;return{size:a.toFixed(2),unit:"GB"}}var g={config:{title:"",clientRootPath:"",sysRootPath:"",pathSeperator:""}},_={data:function(){return{share:g}},mounted:function(){var t=this;s("/api/config").then((function(e){t.share.config=e,document.title=t.share.config.title}))}},b=_,w=n("e90a"),y=Object(w["a"])(b,i,r,!1,null,null,null),C=y.exports,x=n("1bee"),F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"nav"}},[n("router-link",{attrs:{to:"/files-manager"}},[t._v("文件管理")])],1)},S=[],D={name:"Home"},k=D,E=Object(w["a"])(k,F,S,!1,null,null,null),O=E.exports,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.share.config.title?n("ol",{staticClass:"breadcrumb"},[n("li",[n("a",{attrs:{href:"javascript:void(0)"}},[t._v(t._s(t.share.config.title))])])]):t._e(),n("div",{staticClass:"container-fluid",staticStyle:{"margin-top":"1em"}},[n("div",{staticClass:"panel panel-default"},[n("div",{staticClass:"panel-heading"},[t._v("拖拽/选择文件上传")]),n("div",{staticClass:"panel-body"},[n("file-upload",{attrs:{path:t.route.path},on:{"upload-success":t.onUploadSuccess}})],1)]),n("div",{staticClass:"panel panel-primary"},[n("div",{staticClass:"panel-heading"},[t._v("文件管理")]),n("div",{staticClass:"panel-body"},[n("div",{staticClass:"col-row"},[n("div",{staticClass:"col-sm-4 col-xs-12"},[n("div",{staticClass:"input-group input-group-sm"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.vm.dirName,expression:"vm.dirName"}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入目录名称"},domProps:{value:t.vm.dirName},on:{input:function(e){e.target.composing||t.$set(t.vm,"dirName",e.target.value)}}}),n("span",{staticClass:"input-group-btn"},[n("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:t.doCreateDir}},[t._v("创建目录")])])])])])]),n("table",{staticClass:"table table-bordered"},[t._m(0),n("tbody",t._l(t.files.data,(function(e){return n("file-item",{key:e.path||e.name,attrs:{item:e,path:t.route.path},on:{"delete-file":t.onDeleteFile}})})),1),n("tfoot",[n("tr",[n("td",{attrs:{colspan:"4"}},[n("span",{staticStyle:{"padding-right":"10px","font-size":"12px"}},[t._v(" 文件数量: "),n("mark",[t._v(t._s(t.fileTotalCount))])]),n("span",{staticStyle:{"padding-right":"10px","font-size":"12px"}},[t._v(" 总大小: "),n("mark",[t._v(t._s(t.fileTotalSize))])])])])])])])])])},z=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",[n("th",[t._v("名称")]),n("th",[t._v("路径")]),n("th",[t._v("信息")]),n("th",[t._v("操作")])])])}],P=(n("dbb3"),n("ecb4"),n("1784"),n("77ad"),n("ea69"),n("053b"),n("31a0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",{attrs:{title:t.item.name}},[t.item.isParent?[n("td",{attrs:{colspan:"4"}},[n("router-link",{staticClass:"small",attrs:{to:t.item.link}},[t._v(t._s(t.item.name))])],1)]:t._e(),t.item.isParent?t._e():[n("td",[t.item.isDir?n("router-link",{staticClass:"text-ellipsis",staticStyle:{"max-width":"200px"},attrs:{to:t.item.link}},[t._v(t._s(t.item.name))]):t._e(),t.item.isFile?n("span",{staticClass:"text-ellipsis",staticStyle:{"max-width":"200px"}},[t._v(t._s(t.item.name))]):t._e()],1),n("td",[t.fileAddress?n("code",[t._v(t._s(t.fileAddress))]):t._e()]),n("td",[t.item.isFile?n("span",{staticClass:"small text-info",attrs:{title:"大小 | 修改时间"}},[t._v(t._s(t._f("showSize")(t.item.size))+" | "+t._s(t.item.mtime))]):n("span",[t._v("--")])]),n("td",[n("button",{staticClass:"btn btn-danger btn-xs",on:{click:function(e){return t.doDeleteFile(t.item)}}},[t._v("删除")]),t._v(" "),t.downloadLink?n("a",{staticClass:"btn btn-default btn-xs",attrs:{target:"blank",href:t.downloadLink}},[t._v("下载")]):t._e()])]],2)}),R=[],N={props:{item:{required:!0},path:{required:!0}},data:function(){return{}},mounted:function(){},methods:{doDeleteFile:function(t){var e=this,n=f;t.isDir&&(n=c),n(this.path,this.item.name).then((function(n){n.success&&e.$emit("delete-file",t)}))}},filters:{showSize:function(t){return v(t).size+v(t).unit}},computed:{downloadLink:function(){if(this.item.isFile)return"/api/file?name=".concat(encodeURIComponent(this.item.name),"&path=").concat(encodeURIComponent(this.path))},fileAddress:function(){return this.item.isParent?"":m(g.config.pathSeperator,g.config.clientRootPath,this.path,this.item.name)}}},T=N,$=Object(w["a"])(T,P,R,!1,null,null,null),L=$.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("input",{attrs:{type:"file",multiple:""},on:{change:t.selectFile}}),t.status.process.filter((function(t){return t.show})).length?n("hr"):t._e(),t._l(t.status.process,(function(e){return n("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"process.show"}],key:e.key,staticClass:"small",class:{"text-info":"loading"===e.load,"text-success":"success"===e.load,"text-danger":"fail"===e.load}},[n("i",[t._v(t._s(e.name))]),t._v(" "),"loading"===e.load?n("span",[t._v("正在上传")]):t._e(),"fail"===e.load?n("span",[t._v("上传失败 "+t._s(e.error))]):t._e(),"success"===e.load?n("span",[t._v("上传成功")]):t._e()])}))],2)},M=[],I=(n("fe59"),n("08ba"),n("a9af"),{props:{path:{required:!0}},data:function(){return{config:{randomName:!1},status:{process:[],onDraging:!1}}},mounted:function(){this.initDrag()},methods:{selectFile:function(t){var e=this,n=t.target.files||[];n.forEach((function(t){return e.uploadFile(t)}))},uploadFile:function(t){var e=this,n=t.name;if(this.config.randomName){var a=t.name.split(".").slice(-1);n=h()+"."+a}var i={key:h(),name:t.name,path:this.path,load:"loading",error:void 0,show:!0};this.status.process.push(i),d(t).then((function(t){return l("/api/files",{name:n,path:e.path,data:t})})).then((function(a){if(a.success)return i.load="success",e.$emit("upload-success",{ctime:(new Date).toJSON(),isDir:!1,isFile:!0,mtime:(new Date).toJSON(),name:n,path:void 0,size:t.size}),"success";throw new Error(a.message||"upload_fail")})).catch((function(t){return i.load="fail",i.error=t.message||t,"fail"})).then((function(t){setTimeout((function(){return i.show=!1}),1e3*("success"===t?2:60))}))},initDrag:function(){var t=this,e=document.documentElement;["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,(function(t){t.preventDefault(),t.stopPropagation()}),!1)})),["dragenter","dragover"].forEach((function(n){e.addEventListener(n,(function(){return t.status.onDraging=!0}),!1)})),["dragleave","drop"].forEach((function(n){e.addEventListener(n,(function(){return t.status.onDraging=!1}),!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files||[];n.forEach((function(e){return t.uploadFile(e)}))}),!1)}}}),A=I,J=Object(w["a"])(A,U,M,!1,null,null,null),q=J.exports,B={data:function(){return{share:g,files:{data:[],totalCount:null,totalSize:0},vm:{dirName:""},route:{path:void 0,parent:void 0},status:{process:[],onDraging:!1}}},mounted:function(){this.loadFiles(),this.onRouteChange()},methods:{loadFiles:function(){var t=this;if(this.route.path){var e=this.route.path;this.files.totalSize=0,p(e).then((function(n){if(e===t.route.path&&(t.files.data=n.files.map((function(t){return{ctime:t.ctime,isDir:t.isDir,isFile:t.isFile,mtime:t.mtime,name:t.name,path:t.path,size:t.size}})).map((function(e){return e.link="".concat(location.pathname,"/").concat(e.name),e.isFile&&(e.downloadLink="/api/file?name=".concat(encodeURIComponent(e.name),"&path=").concat(encodeURIComponent(t.route.path))),t.files.totalSize+=e.size||0,e})),t.files.totalCount=n.totalCount,"string"===typeof t.route.parent)){var a=h();t.files.data.unshift({isParent:!0,isDir:!0,isFile:!1,link:(decodeURIComponent(location.pathname)+a).replace(t.route.path+a,"")+t.route.parent,name:"上一级目录"})}}))}},onRouteChange:function(){this.route.path=this.$route.params.pathMatch||"/","string"===typeof this.route.path&&"/"!==this.route.path?this.route.parent=this.route.path.split("/").slice(0,-1).join("/")||"/":this.route.parent=void 0,this.loadFiles()},onDeleteFile:function(t){var e=this.files.data.indexOf(t);this.files.data.splice(e,1)},onUploadSuccess:function(t){this.files.data.filter((function(e){return e.name===t.name})).length||this.files.data.push(t)},doCreateDir:function(){var t=this.vm.dirName;u(this.route.path,t).then((function(t){t.success&&window.location.reload()}))}},computed:{fileTotalCount:function(){return this.files.data.filter((function(t){return t.isFile})).length},fileTotalSize:function(){var t=this.files.data.reduce((function(t,e){return t+(e.size||0)}),0),e=v(t);return e.size+e.unit}},components:{"file-item":L,"file-upload":q},watch:{$route:"onRouteChange"}},G=B,H=Object(w["a"])(G,j,z,!1,null,null,null),K=H.exports;a["a"].use(x["a"]);var Q=[{path:"/",name:"Home",component:O},{path:"/files-manager",name:"FilesManagerRoot",component:K},{path:"/files-manager/*",name:"FilesManager",component:K},{path:"*",component:O}],V=new x["a"]({mode:"history",base:"/",routes:Q}),W=V;a["a"].config.productionTip=!1,new a["a"]({router:W,render:function(t){return t(C)}}).$mount("#app")}});
//# sourceMappingURL=app.fdcfe23c.js.map