(function(t){function e(e){for(var a,r,s=e[0],l=e[1],u=e[2],p=0,f=[];p<s.length;p++)r=s[p],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&f.push(i[r][0]),i[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);c&&c(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={app:0},o=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var c=l;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("a133"),n("ed0d"),n("f09c"),n("e117");var a=n("0261"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},o=[];n("b4fb"),n("9302"),n("2eeb"),n("fe8a"),n("e18c");function r(t,e,n,a){var i={method:t,headers:{"content-type":"application/json"}};return n&&(e+="?"+Object.keys(n).map((function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n[t]))})).join("&")),a&&(i.body=JSON.stringify(a)),fetch(e,i).then((function(t){return t.json()}))}function s(t,e){return r("GET",t,e)}function l(t,e,n){return r("POST",t,n,e)}function u(t,e){return l("/api/dir",{name:e,path:t})}function c(t,e){return r("DELETE","/api/dir",null,{name:e,path:t})}function p(t,e){return r("DELETE","/api/files",null,{name:e,path:t})}function f(t){return s("/api/files",{path:t})}n("e35a"),n("1c2e"),n("5e9f"),n("0d7a");function d(t){return new Promise((function(e,n){var a=new FileReader;a.onload=function(t){var n=t.target.result.split("base64,")[1];e(n)},a.onerror=function(){n()},a.readAsDataURL(t)}))}function h(){return Date.now().toString(16)+Math.random().toString(16).substr(2)}function m(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];return n.join(t).replace(/(\/{2,})/,"/").replace(/(\\{2,})/,"\\")}var v={config:{title:"",clientRootPath:"",sysRootPath:"",pathSeperator:""}},g={data:function(){return{share:v}},mounted:function(){var t=this;s("/api/config").then((function(e){t.share.config=e,document.title=t.share.config.title}))}},b=g,_=n("e90a"),y=Object(_["a"])(b,i,o,!1,null,null,null),w=y.exports,C=n("1bee"),D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"nav"}},[n("router-link",{attrs:{to:"/files-manager"}},[t._v("文件管理")])],1)},E=[],F={name:"Home"},x=F,S=Object(_["a"])(x,D,E,!1,null,null,null),k=S.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("ol",{staticClass:"breadcrumb"},[n("li",[n("a",{attrs:{href:"javascript:void(0)"}},[t._v(t._s(t.share.config.title))])])]),n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"panel panel-default"},[n("div",{staticClass:"panel-heading"},[t._v("文件上传")]),n("div",{staticClass:"panel-body"},[n("file-upload",{attrs:{path:t.route.path},on:{"upload-success":t.onUploadSuccess}})],1)]),n("div",{staticClass:"panel panel-primary"},[n("div",{staticClass:"panel-heading"},[t._v("文件管理")]),n("div",{staticClass:"panel-body"},[n("div",{staticClass:"col-row"},[n("div",{staticClass:"col-sm-4 col-xs-12"},[n("div",{staticClass:"input-group input-group-sm"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.vm.dirName,expression:"vm.dirName"}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入目录名称"},domProps:{value:t.vm.dirName},on:{input:function(e){e.target.composing||t.$set(t.vm,"dirName",e.target.value)}}}),n("span",{staticClass:"input-group-btn"},[n("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:t.doCreateDir}},[t._v("创建目录")])])])])])]),n("table",{staticClass:"table table-bordered"},[t._m(0),n("tbody",t._l(t.files.data,(function(e){return n("file-item",{key:e.path||e.name,attrs:{item:e,path:t.route.path},on:{"delete-file":t.onDeleteFile}})})),1),n("tfoot",[n("tr",[n("td",{attrs:{colspan:"3"}},[n("span",{staticStyle:{"padding-right":"10px","font-size":"12px"}},[t._v(" 文件数量: "),n("mark",[t._v(t._s(t.fileTotalCount))])]),n("span",{staticStyle:{"padding-right":"10px","font-size":"12px"}},[t._v(" 总大小: "),n("mark",[t._v(t._s(t.fileTotalSize))])])])])])])])])])},j=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",[n("th",[t._v("名称")]),n("th",[t._v("路径")]),n("th",[t._v("操作")])])])}],P=(n("dbb3"),n("ecb4"),n("77ad"),n("ea69"),n("053b"),n("20a5"),n("31a0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",[n("td",[t.item.isDir?n("router-link",{attrs:{to:t.item.link}},[t._v(t._s(t.item.name))]):t._e(),t.item.isFile?n("span",[t._v(t._s(t.item.name))]):t._e()],1),n("td",[t.fileAddress?n("code",[t._v(t._s(t.fileAddress))]):t._e()]),n("td",[t.item.isParent?t._e():n("button",{staticClass:"btn btn-warning btn-xs",on:{click:function(e){return t.doDeleteFile(t.item)}}},[t._v("删除")]),t._v(" "),t.downloadLink?n("a",{staticClass:"btn btn-default btn-xs",attrs:{target:"blank",href:t.downloadLink}},[t._v("下载")]):t._e()])])}),R=[],z={props:{item:{required:!0},path:{required:!0}},data:function(){return{}},mounted:function(){},methods:{doDeleteFile:function(t){var e=this,n=p;t.isDir&&(n=c),n(this.path,this.item.name).then((function(n){n.success&&e.$emit("delete-file",t)}))}},computed:{downloadLink:function(){if(this.item.isFile)return"/api/file?name=".concat(encodeURIComponent(this.item.name),"&path=").concat(encodeURIComponent(this.path))},fileAddress:function(){return this.item.isParent?"":m(v.config.pathSeperator,v.config.clientRootPath,this.path,this.item.name)}}},N=z,T=Object(_["a"])(N,P,R,!1,null,null,null),$=T.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("input",{attrs:{type:"file",multiple:""},on:{change:t.selectFile}}),t._l(t.status.process,(function(e){return n("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"process.show"}],key:e.key},[n("b",[t._v(t._s(e.name))]),"loading"===e.load?n("span",[t._v("正在上传")]):t._e(),"fail"===e.load?n("span",[t._v("上传失败 "+t._s(e.error))]):t._e(),"success"===e.load?n("span",[t._v("上传成功")]):t._e()])}))],2)},M=[],U=(n("fe59"),n("08ba"),n("a9af"),{props:{path:{required:!0}},data:function(){return{config:{randomName:!1},status:{process:[],onDraging:!1}}},mounted:function(){this.initDrag()},methods:{selectFile:function(t){var e=this,n=t.target.files||[];n.forEach((function(t){return e.uploadFile(t)}))},uploadFile:function(t){var e=this,n=t.name;if(this.config.randomName){var a=t.name.split(".").slice(-1);n=h()+"."+a}var i={key:h(),name:t.name,path:this.path,load:"loading",error:void 0,show:!0};this.status.process.push(i),d(t).then((function(t){return l("/api/files",{name:n,path:e.path,data:t})})).then((function(a){if(a.success)return i.load="success",e.$emit("upload-success",{ctime:(new Date).toJSON(),isDir:!1,isFile:!0,mtime:(new Date).toJSON(),name:n,path:void 0,size:t.size}),"success";throw new Error("upload_fail")})).catch((function(t){return i.load="fail",i.error=t.message||t,"fail"})).then((function(t){setTimeout((function(){return i.show=!1}),"success"===t?3e3:5e3)}))},initDrag:function(){var t=this,e=document.documentElement;["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,(function(t){t.preventDefault(),t.stopPropagation()}),!1)})),["dragenter","dragover"].forEach((function(n){e.addEventListener(n,(function(){return t.status.onDraging=!0}),!1)})),["dragleave","drop"].forEach((function(n){e.addEventListener(n,(function(){return t.status.onDraging=!1}),!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files||[];n.forEach((function(e){return t.uploadFile(e)}))}),!1)}}}),I=U,A=Object(_["a"])(I,L,M,!1,null,null,null),J=A.exports,q={data:function(){return{share:v,files:{data:[],totalCount:null,totalSize:0},vm:{dirName:""},route:{path:void 0,parent:void 0},status:{process:[],onDraging:!1}}},mounted:function(){this.loadFiles(),this.onRouteChange()},methods:{loadFiles:function(){var t=this;if(this.route.path){var e=this.route.path;this.files.totalSize=0,f(e).then((function(n){if(e===t.route.path&&(t.files.data=n.files.map((function(t){return{ctime:t.ctime,isDir:t.isDir,isFile:t.isFile,mtime:t.mtime,name:t.name,path:t.path,size:t.size}})).map((function(e){return e.link="".concat(location.pathname,"/").concat(e.name),e.isFile&&(e.downloadLink="/api/file?name=".concat(encodeURIComponent(e.name),"&path=").concat(encodeURIComponent(t.route.path))),t.files.totalSize+=e.size||0,e})),t.files.totalCount=n.totalCount,"string"===typeof t.route.parent)){var a=h();t.files.data.unshift({isParent:!0,isDir:!0,isFile:!1,link:(location.pathname+a).replace(t.route.path+a,"")+t.route.parent,name:"上一级目录"})}}))}},onRouteChange:function(){this.route.path=this.$route.params.pathMatch||"/","string"===typeof this.route.path&&"/"!==this.route.path?this.route.parent=this.route.path.split("/").slice(0,-1).join("/")||"/":this.route.parent=void 0,this.loadFiles()},onDeleteFile:function(t){var e=this.files.data.indexOf(t);this.files.data.splice(e,1)},onUploadSuccess:function(t){this.files.data.push(t)},doCreateDir:function(){var t=this.vm.dirName;u(this.route.path,t).then((function(t){t.success&&window.location.reload()}))}},computed:{fileTotalCount:function(){return this.files.data.filter((function(t){return t.isFile})).length},fileTotalSize:function(){var t=this.files.totalSize/1024,e="KB";return t>100&&(t/=1024,e="MB"),t.toFixed(2)+e}},components:{"file-item":$,"file-upload":J},watch:{$route:"onRouteChange"}},B=q,H=Object(_["a"])(B,O,j,!1,null,null,null),G=H.exports;a["a"].use(C["a"]);var K=[{path:"/",name:"Home",component:k},{path:"/files-manager",name:"FilesManagerRoot",component:G},{path:"/files-manager/*",name:"FilesManager",component:G},{path:"*",component:k}],Q=new C["a"]({mode:"history",base:"/",routes:K}),V=Q;a["a"].config.productionTip=!1,new a["a"]({router:V,render:function(t){return t(w)}}).$mount("#app")}});
//# sourceMappingURL=app.52c42b5e.js.map